# #### Purpose ####
# #### Service definitions for every Payflow workload. ####
# #### Includes Prometheus scrape annotations where applicable. ####
# Service definitions for Payflow workloads.
# Each Service exposes one workload inside the payflow namespace.

# frontend exposes the web UI externally via LoadBalancer on port 80.
apiVersion: v1
kind: Service
metadata:
  name: frontend
  namespace: payflow
spec:
  selector:
    app: frontend
  ports:
  - port: 80
    targetPort: 80
  type: LoadBalancer
---
# api-gateway exposes the gateway internally; maps port 80 to container port 3000.
apiVersion: v1
kind: Service
metadata:
  name: api-gateway
  namespace: payflow
  annotations:
    prometheus.io/scrape: "true"
    prometheus.io/port: "3000"
    prometheus.io/path: "/metrics"
spec:
  selector:
    app: api-gateway
  ports:
  - port: 80
    targetPort: 3000
  type: ClusterIP
---
# auth-service exposes the auth API internally on port 3004.
apiVersion: v1
kind: Service
metadata:
  name: auth-service
  namespace: payflow
  annotations:
    prometheus.io/scrape: "true"
    prometheus.io/port: "3004"
    prometheus.io/path: "/metrics"
spec:
  selector:
    app: auth-service
  ports:
  - port: 3004
    targetPort: 3004
  type: ClusterIP
---
# wallet-service exposes the wallet API internally on port 3001.
apiVersion: v1
kind: Service
metadata:
  name: wallet-service
  namespace: payflow
  annotations:
    prometheus.io/scrape: "true"
    prometheus.io/port: "3001"
    prometheus.io/path: "/metrics"
spec:
  selector:
    app: wallet-service
  ports:
  - port: 3001
    targetPort: 3001
  type: ClusterIP
---
# transaction-service exposes the transaction API internally on port 3002.
apiVersion: v1
kind: Service
metadata:
  name: transaction-service
  namespace: payflow
  annotations:
    prometheus.io/scrape: "true"
    prometheus.io/port: "3002"
    prometheus.io/path: "/metrics"
spec:
  selector:
    app: transaction-service
  ports:
  - port: 3002
    targetPort: 3002
  type: ClusterIP
---
# notification-service exposes the notification API internally on port 3003.
apiVersion: v1
kind: Service
metadata:
  name: notification-service
  namespace: payflow
  annotations:
    prometheus.io/scrape: "true"
    prometheus.io/port: "3003"
    prometheus.io/path: "/metrics"
spec:
  selector:
    app: notification-service
  ports:
  - port: 3003
    targetPort: 3003
  type: ClusterIP
---
# postgres-service is headless to provide stable DNS for StatefulSet pods.
apiVersion: v1
kind: Service
metadata:
  name: postgres-service
  namespace: payflow
spec:
  selector:
    app: postgres
  ports:
  - port: 5432
    targetPort: 5432
  clusterIP: None
---
# redis-service exposes Redis internally on port 6379.
apiVersion: v1
kind: Service
metadata:
  name: redis-service
  namespace: payflow
spec:
  selector:
    app: redis
  ports:
  - port: 6379
    targetPort: 6379
  type: ClusterIP
---
# rabbitmq-service is headless for StatefulSet, exposing AMQP and management ports.
apiVersion: v1
kind: Service
metadata:
  name: rabbitmq-service
  namespace: payflow
spec:
  selector:
    app: rabbitmq
  ports:
  - name: amqp
    port: 5672
    targetPort: 5672
  - name: management
    port: 15672
    targetPort: 15672
  clusterIP: None
